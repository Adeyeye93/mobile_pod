import {
  View,
  Text,
  Modal,
  TouchableOpacity,
  KeyboardAvoidingView,
  Platform,
  Image
} from "react-native";
import { useState } from "react";
import { icons } from "@/constants/icons";
import Divider from "../divider";


export default function SortFilter() {
  const [visible, setVisible] = useState(false);
  const [sortBy, setSortBy] = useState("newest");
  const [hideCompleted, setHideCompleted] = useState(false);

  const handleReset = () => {
    setSortBy("newest");
    setHideCompleted(false);
  };

  const handleApply = () => {
    console.log("Applied filters:", { sortBy, hideCompleted });
    setVisible(false);
  };

  return (
    <>
      <TouchableOpacity onPress={() => setVisible(true)}>
        <Image source={icons.sort} className="h-5 w-5" />
      </TouchableOpacity>

      <Modal
        visible={visible}
        transparent
        animationType="slide"
        onRequestClose={() => setVisible(false)}
        className="justify-end m-0 "
      >
        <KeyboardAvoidingView
          behavior={Platform.OS === "ios" ? "padding" : "height"}
          className="flex-1 justify-end bg-black/50 h-full border  "
        >
          <View className="bg-[#1f222b] rounded-t-3xl p-6 pb-8">
            {/* Close button */}
            <TouchableOpacity
              onPress={() => setVisible(false)}
              className="mb-4 self-end"
            >
              <Text className="text-gray-400">âœ•</Text>
            </TouchableOpacity>

            {/* Header */}
            <Text className="text-white text-2xl font-bold text-center font-MonBold">
              Sort & Filter
            </Text>
            <Divider gap={20} value={370} />

            {/* Sort Section */}
            <View className="mb-8">
              <Text className="text-white text-lg font-semibold mb-10 font-MonBold">
                Sort
              </Text>

              <TouchableOpacity
                onPress={() => setSortBy("newest")}
                className="flex flex-row items-center gap-3 mb-4"
              >
                <View
                  className={`w-6 h-6 rounded flex items-center justify-center`}
                >
                  {sortBy === "newest" && (
                    <Image source={icons.selected} className="w-4 h-4" />
                  )}
                </View>
                <Text className="text-white text-base font-MonRegular">
                  Newest First
                </Text>
              </TouchableOpacity>

              <TouchableOpacity
                onPress={() => setSortBy("oldest")}
                className="flex flex-row items-center gap-3"
              >
                <View
                  className={`w-6 h-6 rounded flex items-center justify-center`}
                >
                  {sortBy === "oldest" && (
                    <Image source={icons.selected} className="w-4 h-4" />
                  )}
                </View>
                <Text className="text-white text-base font-MonRegular">
                  Oldest First
                </Text>
              </TouchableOpacity>
            </View>

            {/* Filter Section */}
            <View className="">
              <Text className="text-white text-lg font-semibold mb-4 font-MonBold">
                Filter
              </Text>

              <TouchableOpacity
                onPress={() => setHideCompleted(!hideCompleted)}
                className="flex flex-row items-center gap-3"
              >
                <View
                  className={`w-6 h-6 rounded flex items-center justify-center`}
                >
                  {hideCompleted && (
                    <Image source={icons.hide} className="w-6 h-6" />
                  )}
                  {!hideCompleted && (
                    <Image source={icons.reveal} className="w-6 h-6" />
                  )}
                </View>
                <Text className="text-white text-base font-MonRegular">
                  {hideCompleted ? "Hide Completed Episodes" : "Show Completed Episodes"}
                </Text>
              </TouchableOpacity>
            </View>
            <Divider gap={20} value={370} />

            {/* Buttons */}
            <View className="flex-row gap-4">
              <TouchableOpacity
                onPress={handleReset}
                className="flex-1 bg-gray-700 rounded-full py-3"
              >
                <Text className="text-white text-center font-MonBold">
                  Reset
                </Text>
              </TouchableOpacity>

              <TouchableOpacity
                onPress={handleApply}
                className="flex-1 bg-primary rounded-full py-3"
              >
                <Text className="text-white text-center font-MonBold">
                  Apply
                </Text>
              </TouchableOpacity>
            </View>
          </View>
        </KeyboardAvoidingView>
      </Modal>
    </>
  );
}
